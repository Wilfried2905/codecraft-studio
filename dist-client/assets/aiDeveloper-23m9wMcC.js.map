{"version":3,"file":"aiDeveloper-23m9wMcC.js","sources":["../../src/services/intentAnalyzer.ts","../../src/services/clarificationEngine.ts","../../src/services/agentOrchestrator.ts","../../src/services/errorHandler.ts","../../src/services/codeValidator.ts","../../src/services/aiDeveloper.ts"],"sourcesContent":["/**\n * Intent Analyzer - D√©tecte l'intention et les besoins de l'utilisateur\n */\n\nexport interface UserIntent {\n  type: 'create_app' | 'modify_app' | 'question' | 'clarification_needed';\n  confidence: number;\n  detectedFeatures: string[];\n  detectedStack: string[];\n  complexity: 'simple' | 'medium' | 'complex';\n  needsClarification: boolean;\n  clarificationQuestions: string[];\n}\n\nexport interface Requirements {\n  appType?: string; // 'e-commerce', 'landing-page', 'dashboard', 'portfolio', etc.\n  stack?: string[]; // ['React', 'TypeScript', 'Tailwind']\n  features?: string[]; // ['auth', 'payment', 'crud', 'realtime']\n  design?: string; // 'minimal', 'modern', 'corporate'\n  target?: string; // 'web', 'mobile', 'both'\n  database?: boolean;\n  authentication?: boolean;\n  uploadedFiles?: Array<{ name: string; content: string; type: string }>;\n}\n\nexport class IntentAnalyzer {\n  /**\n   * Analyse le prompt utilisateur et d√©tecte l'intention\n   */\n  async analyze(userPrompt: string, uploadedFiles?: Array<{ name: string; content: string; type: string }>): Promise<{\n    intent: UserIntent;\n    requirements: Requirements;\n  }> {\n    const normalizedPrompt = userPrompt.toLowerCase();\n\n    // D√©tecter le type d'intention\n    const intent = this.detectIntent(normalizedPrompt);\n\n    // Extraire les requirements\n    const requirements = this.extractRequirements(normalizedPrompt, uploadedFiles);\n\n    // √âvaluer si clarification n√©cessaire\n    const clarification = this.evaluateClarificationNeeds(intent, requirements);\n\n    return {\n      intent: {\n        ...intent,\n        needsClarification: clarification.needed,\n        clarificationQuestions: clarification.questions,\n      },\n      requirements,\n    };\n  }\n\n  /**\n   * D√©tecte le type d'intention principale\n   */\n  private detectIntent(prompt: string): UserIntent {\n    const createKeywords = ['cr√©er', 'faire', 'g√©n√©rer', 'construire', 'd√©velopper', 'app', 'site', 'application'];\n    const modifyKeywords = ['modifier', 'changer', 'am√©liorer', 'ajouter', 'supprimer', 'corriger'];\n    const questionKeywords = ['comment', 'pourquoi', 'qu\\'est-ce', 'est-ce que', 'peux-tu', '?'];\n\n    let type: UserIntent['type'] = 'question';\n    let confidence = 0;\n\n    // D√©tecter \"cr√©er une application\"\n    if (createKeywords.some(kw => prompt.includes(kw))) {\n      type = 'create_app';\n      confidence = 0.8;\n    }\n\n    // D√©tecter \"modifier\"\n    if (modifyKeywords.some(kw => prompt.includes(kw))) {\n      type = 'modify_app';\n      confidence = 0.7;\n    }\n\n    // D√©tecter une simple question\n    if (questionKeywords.some(kw => prompt.includes(kw)) && !createKeywords.some(kw => prompt.includes(kw))) {\n      type = 'question';\n      confidence = 0.6;\n    }\n\n    return {\n      type,\n      confidence,\n      detectedFeatures: this.detectFeatures(prompt),\n      detectedStack: this.detectStack(prompt),\n      complexity: this.detectComplexity(prompt),\n      needsClarification: false,\n      clarificationQuestions: [],\n    };\n  }\n\n  /**\n   * Extrait les requirements techniques du prompt\n   */\n  private extractRequirements(prompt: string, uploadedFiles?: Array<{ name: string; content: string; type: string }>): Requirements {\n    const requirements: Requirements = {};\n\n    // D√©tecter le type d'application\n    if (prompt.includes('e-commerce') || prompt.includes('boutique') || prompt.includes('shop')) {\n      requirements.appType = 'e-commerce';\n    } else if (prompt.includes('landing') || prompt.includes('page d\\'accueil')) {\n      requirements.appType = 'landing-page';\n    } else if (prompt.includes('dashboard') || prompt.includes('tableau de bord')) {\n      requirements.appType = 'dashboard';\n    } else if (prompt.includes('portfolio')) {\n      requirements.appType = 'portfolio';\n    } else if (prompt.includes('blog')) {\n      requirements.appType = 'blog';\n    } else if (prompt.includes('crm') || prompt.includes('gestion')) {\n      requirements.appType = 'crm';\n    }\n\n    // D√©tecter les features\n    requirements.features = this.detectFeatures(prompt);\n\n    // D√©tecter le stack technique\n    requirements.stack = this.detectStack(prompt);\n\n    // D√©tecter le design\n    if (prompt.includes('minimal')) {\n      requirements.design = 'minimal';\n    } else if (prompt.includes('moderne') || prompt.includes('anim√©')) {\n      requirements.design = 'modern';\n    } else if (prompt.includes('corporate') || prompt.includes('professionnel')) {\n      requirements.design = 'corporate';\n    }\n\n    // D√©tecter database\n    requirements.database = prompt.includes('base de donn√©es') || prompt.includes('database') || prompt.includes('db');\n\n    // D√©tecter authentication\n    requirements.authentication = prompt.includes('auth') || prompt.includes('connexion') || prompt.includes('login') || prompt.includes('utilisateur');\n\n    // Ajouter les fichiers upload√©s\n    if (uploadedFiles && uploadedFiles.length > 0) {\n      requirements.uploadedFiles = uploadedFiles;\n    }\n\n    return requirements;\n  }\n\n  /**\n   * D√©tecte les features demand√©es\n   */\n  private detectFeatures(prompt: string): string[] {\n    const features: string[] = [];\n\n    const featureMap: Record<string, string[]> = {\n      auth: ['authentification', 'connexion', 'login', 'inscription', 'register'],\n      payment: ['paiement', 'payment', 'stripe', 'paypal', 'checkout'],\n      crud: ['crud', 'cr√©er', 'modifier', 'supprimer', 'gestion'],\n      realtime: ['temps r√©el', 'realtime', 'live', 'instantan√©'],\n      search: ['recherche', 'search', 'filtre', 'filter'],\n      upload: ['upload', 't√©l√©charger', 'fichier', 'image'],\n      api: ['api', 'backend', 'serveur'],\n      responsive: ['responsive', 'mobile', 'tablette', 'adaptatif'],\n      seo: ['seo', 'r√©f√©rencement', 'meta'],\n      analytics: ['analytics', 'statistiques', 'tracking'],\n    };\n\n    for (const [feature, keywords] of Object.entries(featureMap)) {\n      if (keywords.some(kw => prompt.includes(kw))) {\n        features.push(feature);\n      }\n    }\n\n    return features;\n  }\n\n  /**\n   * D√©tecte le stack technique\n   */\n  private detectStack(prompt: string): string[] {\n    const stack: string[] = ['React', 'TypeScript', 'Tailwind CSS']; // Stack par d√©faut\n\n    if (prompt.includes('vue')) stack.push('Vue.js');\n    if (prompt.includes('angular')) stack.push('Angular');\n    if (prompt.includes('svelte')) stack.push('Svelte');\n    if (prompt.includes('node')) stack.push('Node.js');\n    if (prompt.includes('express')) stack.push('Express');\n    if (prompt.includes('next')) stack.push('Next.js');\n    if (prompt.includes('supabase')) stack.push('Supabase');\n    if (prompt.includes('firebase')) stack.push('Firebase');\n\n    return stack;\n  }\n\n  /**\n   * D√©tecte la complexit√© de la demande\n   */\n  private detectComplexity(prompt: string): 'simple' | 'medium' | 'complex' {\n    const features = this.detectFeatures(prompt);\n\n    if (features.length <= 2) return 'simple';\n    if (features.length <= 5) return 'medium';\n    return 'complex';\n  }\n\n  /**\n   * √âvalue si des clarifications sont n√©cessaires\n   */\n  private evaluateClarificationNeeds(intent: UserIntent, requirements: Requirements): {\n    needed: boolean;\n    questions: string[];\n  } {\n    const questions: string[] = [];\n\n    // Si pas de type d'app d√©tect√©\n    if (!requirements.appType && intent.type === 'create_app') {\n      questions.push(\"Quel type d'application voulez-vous cr√©er ? (e-commerce, landing page, dashboard, portfolio, blog, CRM)\");\n    }\n\n    // Si payment d√©tect√© mais pas de provider\n    if (requirements.features?.includes('payment')) {\n      questions.push(\"Quel syst√®me de paiement pr√©f√©rez-vous ? (Stripe, PayPal, ou les deux)\");\n    }\n\n    // Si database mais pas de pr√©cision\n    if (requirements.database && !requirements.stack?.some(s => s.includes('Supabase') || s.includes('Firebase'))) {\n      questions.push(\"Voulez-vous utiliser Supabase, Firebase, ou une autre base de donn√©es ?\");\n    }\n\n    // Si pas de design sp√©cifi√©\n    if (!requirements.design && intent.type === 'create_app') {\n      questions.push(\"Quel style de design pr√©f√©rez-vous ? (minimal, moderne/anim√©, corporate/professionnel)\");\n    }\n\n    return {\n      needed: questions.length > 0,\n      questions,\n    };\n  }\n}\n","/**\n * Clarification Engine - G√©n√®re des questions intelligentes pour clarifier les besoins\n */\n\nimport { Requirements, UserIntent } from './intentAnalyzer';\n\nexport interface ClarificationResponse {\n  needsClarification: boolean;\n  questions: string[];\n  suggestedDefaults?: Record<string, any>;\n}\n\nexport class ClarificationEngine {\n  /**\n   * G√©n√®re des questions de clarification intelligentes\n   */\n  generateQuestions(intent: UserIntent, requirements: Requirements): ClarificationResponse {\n    const questions: string[] = [];\n    const suggestedDefaults: Record<string, any> = {};\n\n    // 1. Type d'application\n    if (!requirements.appType && intent.type === 'create_app') {\n      questions.push(\"üì± **Quel type d'application voulez-vous cr√©er ?**\\n- E-commerce\\n- Landing Page\\n- Dashboard\\n- Portfolio\\n- Blog\\n- CRM / Gestion\\n- Autre (pr√©cisez)\");\n      suggestedDefaults.appType = 'landing-page';\n    }\n\n    // 2. Design & Style\n    if (!requirements.design) {\n      questions.push(\"üé® **Quel style de design pr√©f√©rez-vous ?**\\n- Minimal (√©pur√©, sobre)\\n- Moderne (animations, gradients)\\n- Corporate (professionnel, s√©rieux)\");\n      suggestedDefaults.design = 'modern';\n    }\n\n    // 3. Features avanc√©es\n    if (requirements.appType === 'e-commerce') {\n      if (!requirements.features?.includes('payment')) {\n        questions.push(\"üí≥ **Syst√®me de paiement ?**\\n- Stripe\\n- PayPal\\n- Les deux\\n- Aucun pour l'instant\");\n        suggestedDefaults.payment = 'stripe';\n      }\n\n      if (!requirements.database) {\n        questions.push(\"üì¶ **Gestion de l'inventaire ?**\\n- Oui, avec base de donn√©es (Supabase)\\n- Non, donn√©es statiques pour l'instant\");\n        suggestedDefaults.database = true;\n      }\n    }\n\n    // 4. Authentification\n    if (requirements.features?.includes('auth') || requirements.authentication) {\n      questions.push(\"üîê **Type d'authentification ?**\\n- Email/Password\\n- OAuth (Google, GitHub)\\n- Les deux\");\n      suggestedDefaults.authType = 'both';\n    }\n\n    // 5. Responsive\n    if (!requirements.features?.includes('responsive')) {\n      questions.push(\"üì± **Compatibilit√© mobile ?**\\n- Oui, responsive design\\n- Desktop uniquement\");\n      suggestedDefaults.responsive = true;\n    }\n\n    // 6. Backend / API\n    if (requirements.features?.includes('api') || requirements.features?.includes('crud')) {\n      questions.push(\"‚öôÔ∏è **Backend n√©cessaire ?**\\n- Oui, avec API REST\\n- Non, frontend uniquement\\n- Serverless (Cloudflare Workers)\");\n      suggestedDefaults.backend = 'serverless';\n    }\n\n    // Si pas de questions, tout est clair\n    if (questions.length === 0) {\n      return {\n        needsClarification: false,\n        questions: [],\n      };\n    }\n\n    // Ajouter un message d'introduction\n    const intro = `üìã **J'ai besoin de quelques pr√©cisions pour cr√©er l'application parfaite pour vous :**\\n\\n`;\n    const outro = `\\n\\nüí° **Vous pouvez r√©pondre simplement, ou me dire \"utilise les options par d√©faut\" si vous voulez que je d√©cide.**`;\n\n    return {\n      needsClarification: true,\n      questions: [intro + questions.join('\\n\\n') + outro],\n      suggestedDefaults,\n    };\n  }\n\n  /**\n   * Parse la r√©ponse de l'utilisateur aux questions de clarification\n   */\n  parseUserResponse(userResponse: string, previousRequirements: Requirements): Requirements {\n    const normalized = userResponse.toLowerCase();\n    const updatedRequirements = { ...previousRequirements };\n\n    // D√©tecter \"utilise les options par d√©faut\"\n    if (normalized.includes('d√©faut') || normalized.includes('default') || normalized.includes('d√©cide')) {\n      return {\n        ...updatedRequirements,\n        appType: updatedRequirements.appType || 'landing-page',\n        design: updatedRequirements.design || 'modern',\n        stack: updatedRequirements.stack || ['React', 'TypeScript', 'Tailwind CSS'],\n        features: [...(updatedRequirements.features || []), 'responsive', 'seo'],\n        database: updatedRequirements.database ?? false,\n        authentication: updatedRequirements.authentication ?? false,\n      };\n    }\n\n    // Parser les r√©ponses sp√©cifiques\n    \n    // Type d'app\n    if (normalized.includes('e-commerce') || normalized.includes('boutique')) {\n      updatedRequirements.appType = 'e-commerce';\n    } else if (normalized.includes('landing')) {\n      updatedRequirements.appType = 'landing-page';\n    } else if (normalized.includes('dashboard') || normalized.includes('tableau')) {\n      updatedRequirements.appType = 'dashboard';\n    } else if (normalized.includes('portfolio')) {\n      updatedRequirements.appType = 'portfolio';\n    } else if (normalized.includes('blog')) {\n      updatedRequirements.appType = 'blog';\n    } else if (normalized.includes('crm') || normalized.includes('gestion')) {\n      updatedRequirements.appType = 'crm';\n    }\n\n    // Design\n    if (normalized.includes('minimal') || normalized.includes('√©pur√©')) {\n      updatedRequirements.design = 'minimal';\n    } else if (normalized.includes('moderne') || normalized.includes('anim√©')) {\n      updatedRequirements.design = 'modern';\n    } else if (normalized.includes('corporate') || normalized.includes('professionnel')) {\n      updatedRequirements.design = 'corporate';\n    }\n\n    // Payment\n    if (normalized.includes('stripe')) {\n      updatedRequirements.features = [...(updatedRequirements.features || []), 'payment-stripe'];\n    }\n    if (normalized.includes('paypal')) {\n      updatedRequirements.features = [...(updatedRequirements.features || []), 'payment-paypal'];\n    }\n\n    // Database\n    if (normalized.includes('base de donn√©es') || normalized.includes('database') || normalized.includes('supabase')) {\n      updatedRequirements.database = true;\n      if (!updatedRequirements.stack?.includes('Supabase')) {\n        updatedRequirements.stack = [...(updatedRequirements.stack || []), 'Supabase'];\n      }\n    }\n\n    // Authentication\n    if (normalized.includes('auth') || normalized.includes('connexion') || normalized.includes('login')) {\n      updatedRequirements.authentication = true;\n      updatedRequirements.features = [...(updatedRequirements.features || []), 'auth'];\n    }\n\n    // Responsive\n    if (normalized.includes('responsive') || normalized.includes('mobile') || normalized.includes('oui')) {\n      updatedRequirements.features = [...(updatedRequirements.features || []), 'responsive'];\n    }\n\n    return updatedRequirements;\n  }\n}\n","/**\n * Agent Orchestrator - Orchestre l'ex√©cution intelligente et parall√®le des agents\n */\n\nimport { Requirements } from './intentAnalyzer';\n\nexport interface Agent {\n  id: string;\n  name: string;\n  role: string;\n  systemPrompt: string;\n  priority: number;\n}\n\nexport interface AgentResult {\n  agentId: string;\n  agentName: string;\n  output: string;\n  executionTime: number;\n  success: boolean;\n}\n\nexport interface OrchestrationPlan {\n  selectedAgents: Agent[];\n  executionMode: 'parallel' | 'sequential';\n  estimatedTime: number;\n}\n\nexport class AgentOrchestrator {\n  private agents: Agent[] = [\n    // ========== AGENTS DE BASE ==========\n    {\n      id: 'architect',\n      name: 'Architecte',\n      role: 'Structure et architecture de l\\'application',\n      systemPrompt: `Tu es un architecte logiciel expert. Ton r√¥le est de concevoir la structure compl√®te de l'application : \n- Architecture des dossiers et fichiers\n- Choix des d√©pendances et packages\n- Structure des composants React\n- Gestion de l'√©tat (Context, hooks)\n- Routing et navigation\n- Configuration (tsconfig, vite.config, etc.)\n\nG√©n√®re une structure de projet claire, scalable et maintenable.`,\n      priority: 1,\n    },\n    {\n      id: 'designer',\n      name: 'Designer UI/UX',\n      role: 'Design, styles, animations, exp√©rience utilisateur',\n      systemPrompt: `Tu es un designer UI/UX expert. Ton r√¥le est de cr√©er une interface moderne et intuitive :\n- Design system (couleurs, typographie, espacements)\n- Composants UI r√©utilisables\n- Animations et transitions fluides\n- Responsive design (mobile, tablet, desktop)\n- Accessibilit√© (ARIA, contraste, navigation clavier)\n\nUtilise Tailwind CSS et cr√©e des interfaces √©l√©gantes et performantes.`,\n      priority: 2,\n    },\n    {\n      id: 'developer',\n      name: 'D√©veloppeur',\n      role: 'Code fonctionnel, logique m√©tier, int√©gration API',\n      systemPrompt: `Tu es un d√©veloppeur fullstack expert React/TypeScript. Ton r√¥le est d'impl√©menter :\n- Composants React fonctionnels avec TypeScript\n- Hooks personnalis√©s (useState, useEffect, useContext)\n- Logique m√©tier et gestion de l'√©tat\n- Int√©gration d'API externes\n- Gestion des erreurs et validations\n- Performance et optimisations\n\nG√©n√®re du code propre, typ√©, comment√© et production-ready.`,\n      priority: 3,\n    },\n    {\n      id: 'tester',\n      name: 'Testeur QA',\n      role: 'Tests, validation, edge cases',\n      systemPrompt: `Tu es un testeur QA expert. Ton r√¥le est de garantir la qualit√© :\n- Tests unitaires (Vitest, React Testing Library)\n- Tests d'int√©gration\n- Edge cases et sc√©narios d'erreur\n- Validation des inputs\n- Tests de performance\n- Accessibilit√© (a11y)\n\nG√©n√®re des tests complets et des validations robustes.`,\n      priority: 4,\n    },\n    {\n      id: 'documenter',\n      name: 'Documenteur',\n      role: 'Documentation technique, README, commentaires',\n      systemPrompt: `Tu es un expert en documentation technique. Ton r√¥le est de documenter :\n- README.md complet avec exemples\n- Commentaires de code clairs\n- Documentation des API\n- Guide d'installation et d√©ploiement\n- Exemples d'utilisation\n- Troubleshooting et FAQ\n\nG√©n√®re une documentation claire, concise et utile.`,\n      priority: 5,\n    },\n\n    // ========== AGENTS CONTEXTUELS ==========\n    {\n      id: 'backend',\n      name: 'Backend Developer',\n      role: 'API, serveur, base de donn√©es',\n      systemPrompt: `Tu es un d√©veloppeur backend expert. Ton r√¥le est de cr√©er :\n- API REST avec Hono (Cloudflare Workers)\n- Routes et middlewares\n- Int√©gration base de donn√©es (Supabase, D1)\n- Authentification et s√©curit√©\n- Gestion des sessions et tokens\n- Rate limiting et caching\n\nG√©n√®re des API s√©curis√©es, performantes et scalables.`,\n      priority: 3,\n    },\n    {\n      id: 'security',\n      name: 'Security Expert',\n      role: 'S√©curit√©, authentification, protection',\n      systemPrompt: `Tu es un expert en s√©curit√© web. Ton r√¥le est de s√©curiser :\n- Authentification (JWT, OAuth, sessions)\n- Protection CSRF, XSS, injection SQL\n- Validation et sanitization des inputs\n- CORS et headers de s√©curit√©\n- Gestion des secrets et API keys\n- Rate limiting et protection DDoS\n\nG√©n√®re un code s√©curis√© selon les meilleures pratiques OWASP.`,\n      priority: 2,\n    },\n    {\n      id: 'performance',\n      name: 'Performance Engineer',\n      role: 'Optimisation, performance, SEO',\n      systemPrompt: `Tu es un expert en performance web. Ton r√¥le est d'optimiser :\n- Lazy loading et code splitting\n- Image optimization (formats modernes, responsive)\n- Caching strat√©gies\n- Bundle size optimization\n- Core Web Vitals (LCP, FID, CLS)\n- SEO (meta tags, sitemap, robots.txt)\n\nG√©n√®re une application ultra-rapide et SEO-friendly.`,\n      priority: 4,\n    },\n    {\n      id: 'devops',\n      name: 'DevOps Engineer',\n      role: 'D√©ploiement, CI/CD, monitoring',\n      systemPrompt: `Tu es un expert DevOps. Ton r√¥le est de configurer :\n- D√©ploiement Cloudflare Pages / Workers\n- CI/CD avec GitHub Actions\n- Environment variables et secrets\n- Monitoring et logging\n- Backup et disaster recovery\n- Scaling et auto-healing\n\nG√©n√®re une infrastructure cloud robuste et automatis√©e.`,\n      priority: 5,\n    },\n    {\n      id: 'mobile',\n      name: 'Mobile Developer',\n      role: 'Responsive, PWA, mobile-first',\n      systemPrompt: `Tu es un expert en d√©veloppement mobile. Ton r√¥le est de cr√©er :\n- Design responsive (mobile-first)\n- PWA (Progressive Web App) avec service workers\n- Touch gestures et interactions mobiles\n- Performance mobile (3G, 4G)\n- Offline mode et caching\n- App-like experience (splash screen, icons)\n\nG√©n√®re une exp√©rience mobile native-like.`,\n      priority: 3,\n    },\n    {\n      id: 'seo',\n      name: 'SEO Specialist',\n      role: 'R√©f√©rencement, meta tags, analytics',\n      systemPrompt: `Tu es un expert SEO. Ton r√¥le est d'optimiser :\n- Meta tags (title, description, OG, Twitter)\n- Structured data (JSON-LD)\n- Sitemap.xml et robots.txt\n- Performance (Core Web Vitals)\n- Analytics (Google Analytics, Plausible)\n- Accessibility pour SEO\n\nG√©n√®re une application parfaitement r√©f√©renc√©e.`,\n      priority: 4,\n    },\n    {\n      id: 'accessibility',\n      name: 'Accessibility Expert',\n      role: 'Accessibilit√©, ARIA, navigation clavier',\n      systemPrompt: `Tu es un expert en accessibilit√© (a11y). Ton r√¥le est d'assurer :\n- ARIA labels et roles\n- Navigation clavier compl√®te\n- Screen reader compatibility\n- Contraste de couleurs (WCAG AAA)\n- Focus management\n- Alternative text et descriptions\n\nG√©n√®re une application accessible √† tous (WCAG 2.1 AAA).`,\n      priority: 4,\n    },\n  ];\n\n  /**\n   * S√©lectionne les agents n√©cessaires selon les requirements\n   */\n  selectAgents(requirements: Requirements): Agent[] {\n    const selectedAgents: Agent[] = [];\n\n    // Agents de base (toujours activ√©s)\n    selectedAgents.push(\n      this.getAgent('architect'),\n      this.getAgent('designer'),\n      this.getAgent('developer')\n    );\n\n    // Agents contextuels selon les features\n    if (requirements.features?.includes('api') || requirements.database) {\n      selectedAgents.push(this.getAgent('backend'));\n    }\n\n    if (requirements.authentication || requirements.features?.includes('auth')) {\n      selectedAgents.push(this.getAgent('security'));\n    }\n\n    if (requirements.features?.includes('seo') || requirements.appType === 'landing-page') {\n      selectedAgents.push(this.getAgent('seo'));\n      selectedAgents.push(this.getAgent('performance'));\n    }\n\n    if (requirements.target === 'mobile' || requirements.features?.includes('responsive')) {\n      selectedAgents.push(this.getAgent('mobile'));\n    }\n\n    if (requirements.features?.includes('payment') || requirements.appType === 'e-commerce') {\n      selectedAgents.push(this.getAgent('security'));\n      selectedAgents.push(this.getAgent('backend'));\n    }\n\n    // Toujours ajouter le testeur et le documenteur\n    selectedAgents.push(\n      this.getAgent('tester'),\n      this.getAgent('documenter')\n    );\n\n    // Toujours ajouter l'accessibilit√©\n    selectedAgents.push(this.getAgent('accessibility'));\n\n    // Retirer les doublons et trier par priorit√©\n    return Array.from(new Set(selectedAgents))\n      .sort((a, b) => a.priority - b.priority);\n  }\n\n  /**\n   * Cr√©e un plan d'orchestration\n   */\n  createPlan(requirements: Requirements): OrchestrationPlan {\n    const selectedAgents = this.selectAgents(requirements);\n    \n    // D√©terminer le mode d'ex√©cution\n    const executionMode: 'parallel' | 'sequential' = \n      requirements.complexity === 'complex' ? 'sequential' : 'parallel';\n\n    // Estimer le temps\n    const estimatedTime = executionMode === 'parallel' \n      ? 30 // 30 secondes en parall√®le\n      : selectedAgents.length * 10; // 10 secondes par agent en s√©quentiel\n\n    return {\n      selectedAgents,\n      executionMode,\n      estimatedTime,\n    };\n  }\n\n  /**\n   * Ex√©cute les agents selon le plan (avec vraie API Anthropic)\n   */\n  async execute(\n    plan: OrchestrationPlan,\n    requirements: Requirements,\n    apiUrl: string = '/api/generate'\n  ): Promise<AgentResult[]> {\n    const results: AgentResult[] = [];\n\n    if (plan.executionMode === 'parallel') {\n      // Ex√©cution parall√®le\n      const promises = plan.selectedAgents.map(agent =>\n        this.executeAgent(agent, requirements, apiUrl)\n      );\n\n      const executionResults = await Promise.allSettled(promises);\n\n      executionResults.forEach((result, index) => {\n        if (result.status === 'fulfilled') {\n          results.push(result.value);\n        } else {\n          results.push({\n            agentId: plan.selectedAgents[index].id,\n            agentName: plan.selectedAgents[index].name,\n            output: `Erreur: ${result.reason}`,\n            executionTime: 0,\n            success: false,\n          });\n        }\n      });\n    } else {\n      // Ex√©cution s√©quentielle\n      for (const agent of plan.selectedAgents) {\n        const result = await this.executeAgent(agent, requirements, apiUrl);\n        results.push(result);\n      }\n    }\n\n    return results;\n  }\n\n  /**\n   * Ex√©cute un agent individuel via l'API\n   */\n  private async executeAgent(\n    agent: Agent,\n    requirements: Requirements,\n    apiUrl: string\n  ): Promise<AgentResult> {\n    const startTime = Date.now();\n\n    try {\n      // Construire le prompt pour l'agent\n      const prompt = this.buildPromptForAgent(agent, requirements);\n\n      // Appel API\n      const response = await fetch(apiUrl, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          prompt,\n          agentId: agent.id,\n          agentName: agent.name,\n          systemPrompt: agent.systemPrompt,\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error(`API Error: ${response.status}`);\n      }\n\n      const data = await response.json();\n      const executionTime = Date.now() - startTime;\n\n      return {\n        agentId: agent.id,\n        agentName: agent.name,\n        output: data.code || data.response || '',\n        executionTime,\n        success: true,\n      };\n    } catch (error) {\n      return {\n        agentId: agent.id,\n        agentName: agent.name,\n        output: `Erreur: ${error instanceof Error ? error.message : 'Unknown error'}`,\n        executionTime: Date.now() - startTime,\n        success: false,\n      };\n    }\n  }\n\n  /**\n   * Construit le prompt pour un agent sp√©cifique\n   */\n  private buildPromptForAgent(agent: Agent, requirements: Requirements): string {\n    let prompt = `Tu es ${agent.name}. ${agent.role}\\n\\n`;\n\n    prompt += `**Contexte du projet :**\\n`;\n    prompt += `- Type d'application : ${requirements.appType || 'Application web'}\\n`;\n    prompt += `- Stack technique : ${requirements.stack?.join(', ') || 'React, TypeScript, Tailwind CSS'}\\n`;\n    prompt += `- Design : ${requirements.design || 'modern'}\\n`;\n    \n    if (requirements.features && requirements.features.length > 0) {\n      prompt += `- Features : ${requirements.features.join(', ')}\\n`;\n    }\n\n    if (requirements.database) {\n      prompt += `- Base de donn√©es : Oui\\n`;\n    }\n\n    if (requirements.authentication) {\n      prompt += `- Authentification : Oui\\n`;\n    }\n\n    if (requirements.uploadedFiles && requirements.uploadedFiles.length > 0) {\n      prompt += `\\n**Fichiers fournis par l'utilisateur :**\\n`;\n      requirements.uploadedFiles.forEach(file => {\n        prompt += `\\n### ${file.name} (${file.type})\\n`;\n        prompt += `${file.content.substring(0, 2000)}...\\n`; // Limiter √† 2000 caract√®res\n      });\n    }\n\n    prompt += `\\n**Ta mission :**\\n`;\n    prompt += `G√©n√®re le code ${agent.role} pour cette application. Sois pr√©cis, professionnel et production-ready.\\n`;\n\n    return prompt;\n  }\n\n  /**\n   * Fusionne intelligemment les r√©sultats de tous les agents\n   */\n  mergeResults(results: AgentResult[], requirements: Requirements): string {\n    const successfulResults = results.filter(r => r.success);\n\n    if (successfulResults.length === 0) {\n      return '// Erreur: Aucun agent n\\'a pu g√©n√©rer de code\\n';\n    }\n\n    // Cr√©er une structure de projet compl√®te\n    let mergedCode = `// ========================================\\n`;\n    mergedCode += `// ${requirements.appType?.toUpperCase() || 'APPLICATION'} - G√©n√©r√© par CodeCraft Studio\\n`;\n    mergedCode += `// Stack: ${requirements.stack?.join(', ') || 'React + TypeScript + Tailwind'}\\n`;\n    mergedCode += `// ========================================\\n\\n`;\n\n    // Fusionner les outputs par agent\n    successfulResults.forEach(result => {\n      mergedCode += `\\n// ========== ${result.agentName.toUpperCase()} ==========\\n`;\n      mergedCode += `// Temps d'ex√©cution: ${result.executionTime}ms\\n\\n`;\n      mergedCode += result.output;\n      mergedCode += `\\n\\n`;\n    });\n\n    return mergedCode;\n  }\n\n  /**\n   * R√©cup√®re un agent par son ID\n   */\n  private getAgent(id: string): Agent {\n    const agent = this.agents.find(a => a.id === id);\n    if (!agent) {\n      throw new Error(`Agent '${id}' not found`);\n    }\n    return agent;\n  }\n\n  /**\n   * R√©cup√®re tous les agents disponibles\n   */\n  getAllAgents(): Agent[] {\n    return this.agents;\n  }\n}\n","/**\n * Error Handler - Gestion centralis√©e des erreurs\n */\n\nexport class AppError extends Error {\n  constructor(\n    public code: string,\n    public message: string,\n    public statusCode: number = 500,\n    public details?: any\n  ) {\n    super(message)\n    this.name = 'AppError'\n  }\n}\n\nexport class ValidationError extends AppError {\n  constructor(message: string, details?: any) {\n    super('VALIDATION_ERROR', message, 400, details)\n    this.name = 'ValidationError'\n  }\n}\n\nexport class APIError extends AppError {\n  constructor(message: string, details?: any) {\n    super('API_ERROR', message, 502, details)\n    this.name = 'APIError'\n  }\n}\n\nexport class FileProcessingError extends AppError {\n  constructor(message: string, details?: any) {\n    super('FILE_PROCESSING_ERROR', message, 422, details)\n    this.name = 'FileProcessingError'\n  }\n}\n\nexport class AgentExecutionError extends AppError {\n  constructor(message: string, details?: any) {\n    super('AGENT_EXECUTION_ERROR', message, 500, details)\n    this.name = 'AgentExecutionError'\n  }\n}\n\n/**\n * Formatte une erreur pour l'affichage utilisateur\n */\nexport function formatErrorMessage(error: unknown): string {\n  if (error instanceof AppError) {\n    return `‚ùå **${error.name}**\\n\\n${error.message}${error.details ? `\\n\\nD√©tails: ${JSON.stringify(error.details, null, 2)}` : ''}`\n  }\n\n  if (error instanceof Error) {\n    return `‚ùå **Erreur**\\n\\n${error.message}`\n  }\n\n  return `‚ùå **Erreur inconnue**\\n\\nUne erreur inattendue est survenue.`\n}\n\n/**\n * Log une erreur avec contexte\n */\nexport function logError(error: unknown, context?: string) {\n  const timestamp = new Date().toISOString()\n  const prefix = context ? `[${context}]` : ''\n  \n  console.error(`${timestamp} ${prefix} Error:`, error)\n  \n  if (error instanceof AppError) {\n    console.error(`  Code: ${error.code}`)\n    console.error(`  Status: ${error.statusCode}`)\n    if (error.details) {\n      console.error(`  Details:`, error.details)\n    }\n  }\n}\n\n/**\n * Retry logic pour appels API\n */\nexport async function retryAsync<T>(\n  fn: () => Promise<T>,\n  options: {\n    maxRetries?: number\n    delayMs?: number\n    onRetry?: (attempt: number, error: unknown) => void\n  } = {}\n): Promise<T> {\n  const { maxRetries = 3, delayMs = 1000, onRetry } = options\n  \n  let lastError: unknown\n  \n  for (let attempt = 1; attempt <= maxRetries; attempt++) {\n    try {\n      return await fn()\n    } catch (error) {\n      lastError = error\n      \n      if (attempt < maxRetries) {\n        if (onRetry) {\n          onRetry(attempt, error)\n        }\n        \n        // Exponential backoff\n        const delay = delayMs * Math.pow(2, attempt - 1)\n        await new Promise(resolve => setTimeout(resolve, delay))\n      }\n    }\n  }\n  \n  throw lastError\n}\n\n/**\n * Timeout pour les op√©rations longues\n */\nexport async function withTimeout<T>(\n  promise: Promise<T>,\n  timeoutMs: number,\n  timeoutMessage = 'Operation timed out'\n): Promise<T> {\n  return Promise.race([\n    promise,\n    new Promise<T>((_, reject) =>\n      setTimeout(() => reject(new AppError('TIMEOUT', timeoutMessage, 408)), timeoutMs)\n    )\n  ])\n}\n\n/**\n * Safe JSON parse avec fallback\n */\nexport function safeJsonParse<T>(json: string, fallback: T): T {\n  try {\n    return JSON.parse(json)\n  } catch {\n    return fallback\n  }\n}\n\n/**\n * Validation helper\n */\nexport function validate(condition: boolean, message: string, details?: any): void {\n  if (!condition) {\n    throw new ValidationError(message, details)\n  }\n}\n","/**\n * Code Validator - Valide et sanitize le code g√©n√©r√©\n */\n\nexport interface ValidationResult {\n  isValid: boolean;\n  errors: string[];\n  warnings: string[];\n  sanitized?: string;\n}\n\n/**\n * Valide du code HTML\n */\nexport function validateHTML(code: string): ValidationResult {\n  const errors: string[] = [];\n  const warnings: string[] = [];\n\n  // Check if code is not empty\n  if (!code || code.trim().length === 0) {\n    errors.push('Le code g√©n√©r√© est vide');\n    return { isValid: false, errors, warnings };\n  }\n\n  // Check for basic HTML structure\n  if (!code.includes('<html')) {\n    warnings.push('Pas de balise <html> d√©tect√©e');\n  }\n\n  if (!code.includes('<head')) {\n    warnings.push('Pas de balise <head> d√©tect√©e');\n  }\n\n  if (!code.includes('<body')) {\n    warnings.push('Pas de balise <body> d√©tect√©e');\n  }\n\n  // Check for unclosed tags\n  const openingTags = code.match(/<(?!\\/)[\\w-]+(?:\\s[^>]*)?>/g) || [];\n  const closingTags = code.match(/<\\/[\\w-]+>/g) || [];\n  \n  const openingTagNames = openingTags.map(tag => tag.match(/^<([\\w-]+)/)?.[1]).filter(Boolean);\n  const closingTagNames = closingTags.map(tag => tag.match(/^<\\/([\\w-]+)>/)?.[1]).filter(Boolean);\n\n  // Self-closing tags\n  const selfClosing = ['br', 'hr', 'img', 'input', 'meta', 'link'];\n  \n  const unclosedTags = openingTagNames.filter(\n    tag => !selfClosing.includes(tag || '') && \n    openingTagNames.filter(t => t === tag).length > closingTagNames.filter(t => t === tag).length\n  );\n\n  if (unclosedTags.length > 0) {\n    warnings.push(`Balises potentiellement non ferm√©es: ${unclosedTags.join(', ')}`);\n  }\n\n  // Check for dangerous code\n  if (code.includes('<script>alert') || code.includes('javascript:')) {\n    warnings.push('Code JavaScript potentiellement dangereux d√©tect√©');\n  }\n\n  // Check for inline styles abuse\n  const inlineStylesCount = (code.match(/style\\s*=\\s*\"/g) || []).length;\n  if (inlineStylesCount > 10) {\n    warnings.push(`Beaucoup de styles inline (${inlineStylesCount}). Consid√©rez utiliser des classes CSS.`);\n  }\n\n  return {\n    isValid: errors.length === 0,\n    errors,\n    warnings,\n    sanitized: code\n  };\n}\n\n/**\n * Valide du code CSS\n */\nexport function validateCSS(code: string): ValidationResult {\n  const errors: string[] = [];\n  const warnings: string[] = [];\n\n  if (!code || code.trim().length === 0) {\n    // CSS vide n'est pas forc√©ment une erreur\n    return { isValid: true, errors, warnings };\n  }\n\n  // Check for unclosed braces\n  const openBraces = (code.match(/{/g) || []).length;\n  const closeBraces = (code.match(/}/g) || []).length;\n\n  if (openBraces !== closeBraces) {\n    errors.push(`Accolades non √©quilibr√©es: ${openBraces} ouvrantes, ${closeBraces} fermantes`);\n  }\n\n  // Check for common CSS errors\n  if (code.includes(';;')) {\n    warnings.push('Points-virgules doubles d√©tect√©s');\n  }\n\n  return {\n    isValid: errors.length === 0,\n    errors,\n    warnings,\n    sanitized: code\n  };\n}\n\n/**\n * Valide du code JavaScript\n */\nexport function validateJavaScript(code: string): ValidationResult {\n  const errors: string[] = [];\n  const warnings: string[] = [];\n\n  if (!code || code.trim().length === 0) {\n    return { isValid: true, errors, warnings };\n  }\n\n  // Check for unclosed braces/brackets/parentheses\n  const checks = [\n    { open: '{', close: '}', name: 'accolades' },\n    { open: '[', close: ']', name: 'crochets' },\n    { open: '(', close: ')', name: 'parenth√®ses' }\n  ];\n\n  checks.forEach(({ open, close, name }) => {\n    const openCount = (code.match(new RegExp(`\\\\${open}`, 'g')) || []).length;\n    const closeCount = (code.match(new RegExp(`\\\\${close}`, 'g')) || []).length;\n\n    if (openCount !== closeCount) {\n      errors.push(`${name} non √©quilibr√©es: ${openCount} ouvrantes, ${closeCount} fermantes`);\n    }\n  });\n\n  // Check for dangerous code\n  if (code.includes('eval(')) {\n    warnings.push('Usage de eval() d√©tect√© (potentiellement dangereux)');\n  }\n\n  if (code.includes('innerHTML') && !code.includes('textContent')) {\n    warnings.push('Usage de innerHTML d√©tect√©. Consid√©rez textContent pour √©viter XSS.');\n  }\n\n  return {\n    isValid: errors.length === 0,\n    errors,\n    warnings,\n    sanitized: code\n  };\n}\n\n/**\n * Sanitize du code HTML (enl√®ve scripts malveillants)\n */\nexport function sanitizeHTML(code: string): string {\n  let sanitized = code;\n\n  // Remove dangerous event handlers\n  const dangerousEvents = ['onerror', 'onload', 'onclick', 'onmouseover'];\n  dangerousEvents.forEach(event => {\n    const regex = new RegExp(`${event}\\\\s*=\\\\s*[\"'][^\"']*[\"']`, 'gi');\n    sanitized = sanitized.replace(regex, '');\n  });\n\n  // Remove javascript: links\n  sanitized = sanitized.replace(/javascript:/gi, '');\n\n  // Remove data: URLs (can be used for XSS)\n  sanitized = sanitized.replace(/data:text\\/html/gi, '');\n\n  return sanitized;\n}\n\n/**\n * Valide un projet complet (HTML + CSS + JS)\n */\nexport function validateProject(html: string, css?: string, js?: string): ValidationResult {\n  const htmlResult = validateHTML(html);\n  const cssResult = css ? validateCSS(css) : { isValid: true, errors: [], warnings: [] };\n  const jsResult = js ? validateJavaScript(js) : { isValid: true, errors: [], warnings: [] };\n\n  return {\n    isValid: htmlResult.isValid && cssResult.isValid && jsResult.isValid,\n    errors: [\n      ...htmlResult.errors.map(e => `HTML: ${e}`),\n      ...cssResult.errors.map(e => `CSS: ${e}`),\n      ...jsResult.errors.map(e => `JS: ${e}`)\n    ],\n    warnings: [\n      ...htmlResult.warnings.map(w => `HTML: ${w}`),\n      ...cssResult.warnings.map(w => `CSS: ${w}`),\n      ...jsResult.warnings.map(w => `JS: ${w}`)\n    ],\n    sanitized: sanitizeHTML(html)\n  };\n}\n\n/**\n * G√©n√®re un rapport de validation\n */\nexport function generateValidationReport(result: ValidationResult): string {\n  if (result.isValid && result.warnings.length === 0) {\n    return '‚úÖ **Code valide** - Aucun probl√®me d√©tect√©';\n  }\n\n  let report = '';\n\n  if (!result.isValid) {\n    report += '‚ùå **Erreurs d√©tect√©es**\\n\\n';\n    result.errors.forEach((error, i) => {\n      report += `${i + 1}. ${error}\\n`;\n    });\n    report += '\\n';\n  }\n\n  if (result.warnings.length > 0) {\n    report += '‚ö†Ô∏è  **Avertissements**\\n\\n';\n    result.warnings.forEach((warning, i) => {\n      report += `${i + 1}. ${warning}\\n`;\n    });\n  }\n\n  return report;\n}\n","/**\n * AI Developer - Cerveau principal du syst√®me\n * Orchestre l'analyse, la clarification et l'ex√©cution des agents\n */\n\nimport { IntentAnalyzer, Requirements, UserIntent } from './intentAnalyzer';\nimport { ClarificationEngine } from './clarificationEngine';\nimport { AgentOrchestrator, AgentResult } from './agentOrchestrator';\nimport { logError, formatErrorMessage, ValidationError } from './errorHandler';\nimport { validateProject, generateValidationReport } from './codeValidator';\n\nexport interface DeveloperResponse {\n  type: 'clarification' | 'execution' | 'error';\n  message: string;\n  code?: string;\n  requirements?: Requirements;\n  agentResults?: AgentResult[];\n  executionPlan?: string;\n}\n\nexport class AIDeveloper {\n  private intentAnalyzer: IntentAnalyzer;\n  private clarificationEngine: ClarificationEngine;\n  private agentOrchestrator: AgentOrchestrator;\n  private conversationState: {\n    awaitingClarification: boolean;\n    currentIntent?: UserIntent;\n    currentRequirements?: Requirements;\n  };\n\n  constructor() {\n    this.intentAnalyzer = new IntentAnalyzer();\n    this.clarificationEngine = new ClarificationEngine();\n    this.agentOrchestrator = new AgentOrchestrator();\n    this.conversationState = {\n      awaitingClarification: false,\n    };\n  }\n\n  /**\n   * Point d'entr√©e principal - Traite la demande de l'utilisateur\n   */\n  async process(\n    userPrompt: string,\n    uploadedFiles?: Array<{ name: string; content: string; type: string }>\n  ): Promise<DeveloperResponse> {\n    try {\n      // Validation\n      if (!userPrompt || userPrompt.trim().length === 0) {\n        throw new ValidationError('Le prompt ne peut pas √™tre vide');\n      }\n\n      if (userPrompt.length > 10000) {\n        throw new ValidationError('Le prompt est trop long (maximum 10000 caract√®res)');\n      }\n\n      // √âtape 1: Analyser l'intention\n      const { intent, requirements } = await this.intentAnalyzer.analyze(userPrompt, uploadedFiles);\n\n      // Cas 1: L'utilisateur r√©pond √† une clarification\n      if (this.conversationState.awaitingClarification) {\n        return await this.handleClarificationResponse(userPrompt);\n      }\n\n      // Cas 2: Simple question (pas de code √† g√©n√©rer)\n      if (intent.type === 'question') {\n        return {\n          type: 'clarification',\n          message: this.generateQuestionResponse(userPrompt),\n        };\n      }\n\n      // Cas 3: Clarification n√©cessaire\n      if (intent.needsClarification) {\n        return this.requestClarification(intent, requirements);\n      }\n\n      // Cas 4: Ex√©cution directe\n      return await this.executeGeneration(requirements);\n\n    } catch (error) {\n      logError(error, 'AIDeveloper.process');\n      return {\n        type: 'error',\n        message: formatErrorMessage(error),\n      };\n    }\n  }\n\n  /**\n   * Demande des clarifications √† l'utilisateur\n   */\n  private requestClarification(intent: UserIntent, requirements: Requirements): DeveloperResponse {\n    const clarification = this.clarificationEngine.generateQuestions(intent, requirements);\n\n    // Sauvegarder l'√©tat\n    this.conversationState = {\n      awaitingClarification: true,\n      currentIntent: intent,\n      currentRequirements: requirements,\n    };\n\n    return {\n      type: 'clarification',\n      message: clarification.questions.join('\\n\\n'),\n      requirements,\n    };\n  }\n\n  /**\n   * Traite la r√©ponse de l'utilisateur √† une clarification\n   */\n  private async handleClarificationResponse(userResponse: string): Promise<DeveloperResponse> {\n    if (!this.conversationState.currentRequirements) {\n      return {\n        type: 'error',\n        message: 'Erreur: √âtat de clarification invalide',\n      };\n    }\n\n    // Parser la r√©ponse et mettre √† jour les requirements\n    const updatedRequirements = this.clarificationEngine.parseUserResponse(\n      userResponse,\n      this.conversationState.currentRequirements\n    );\n\n    // R√©initialiser l'√©tat\n    this.conversationState.awaitingClarification = false;\n\n    // Ex√©cuter la g√©n√©ration\n    return await this.executeGeneration(updatedRequirements);\n  }\n\n  /**\n   * Ex√©cute la g√©n√©ration de l'application\n   */\n  private async executeGeneration(requirements: Requirements): Promise<DeveloperResponse> {\n    // Cr√©er le plan d'orchestration\n    const plan = this.agentOrchestrator.createPlan(requirements);\n\n    // Message de d√©but\n    const planMessage = this.generatePlanMessage(plan, requirements);\n\n    // Ex√©cuter les agents\n    const agentResults = await this.agentOrchestrator.execute(plan, requirements);\n\n    // Fusionner les r√©sultats\n    const generatedCode = this.agentOrchestrator.mergeResults(agentResults, requirements);\n\n    // Valider le code g√©n√©r√©\n    const validationResult = validateProject(generatedCode);\n    const validationReport = generateValidationReport(validationResult);\n\n    // G√©n√©rer le message de r√©ponse\n    const responseMessage = this.generateExecutionMessage(agentResults, requirements);\n\n    // Ajouter le rapport de validation au message\n    const finalMessage = planMessage + '\\n\\n' + responseMessage + '\\n\\n' + validationReport;\n\n    return {\n      type: 'execution',\n      message: finalMessage,\n      code: validationResult.sanitized || generatedCode,\n      requirements,\n      agentResults,\n      executionPlan: planMessage,\n    };\n  }\n\n  /**\n   * G√©n√®re le message du plan d'ex√©cution\n   */\n  private generatePlanMessage(plan: any, requirements: Requirements): string {\n    const appType = requirements.appType || 'Application web';\n    const stack = requirements.stack?.join(', ') || 'React, TypeScript, Tailwind CSS';\n\n    let message = `‚úÖ **Parfait ! Je vais cr√©er votre ${appType}**\\n\\n`;\n\n    message += `üì¶ **Stack technique :**\\n`;\n    message += `- ${stack}\\n`;\n    \n    if (requirements.design) {\n      message += `- Design : ${requirements.design}\\n`;\n    }\n\n    if (requirements.features && requirements.features.length > 0) {\n      message += `\\nüé® **Features incluses :**\\n`;\n      requirements.features.forEach(feature => {\n        message += `- ${feature}\\n`;\n      });\n    }\n\n    message += `\\nü§ñ **Agents mobilis√©s (${plan.selectedAgents.length}) :**\\n`;\n    plan.selectedAgents.forEach((agent: any) => {\n      message += `- ${agent.name} (${agent.role})\\n`;\n    });\n\n    message += `\\n‚ö° **Mode d'ex√©cution :** ${plan.executionMode === 'parallel' ? 'Parall√®le (rapide)' : 'S√©quentiel (pr√©cis)'}\\n`;\n    message += `‚è±Ô∏è **Temps estim√© :** ~${plan.estimatedTime}s\\n`;\n\n    message += `\\nüöÄ **G√©n√©ration en cours...**`;\n\n    return message;\n  }\n\n  /**\n   * G√©n√®re le message apr√®s l'ex√©cution\n   */\n  private generateExecutionMessage(agentResults: AgentResult[], requirements: Requirements): string {\n    const successCount = agentResults.filter(r => r.success).length;\n    const totalCount = agentResults.length;\n\n    let message = `\\n\\n‚úÖ **G√©n√©ration termin√©e !**\\n\\n`;\n    message += `üìä **R√©sum√© :**\\n`;\n    message += `- ${successCount}/${totalCount} agents ont r√©ussi\\n`;\n\n    const totalTime = agentResults.reduce((sum, r) => sum + r.executionTime, 0);\n    message += `- Temps total : ${(totalTime / 1000).toFixed(2)}s\\n`;\n\n    message += `\\nüíª **Code g√©n√©r√© :**\\n`;\n    message += `- Structure compl√®te de projet\\n`;\n    message += `- Composants React + TypeScript\\n`;\n    message += `- Styles Tailwind CSS\\n`;\n    message += `- Configuration Vite\\n`;\n\n    if (requirements.features && requirements.features.length > 0) {\n      message += `\\n‚ú® **Features impl√©ment√©es :**\\n`;\n      requirements.features.forEach(feature => {\n        message += `- ${feature}\\n`;\n      });\n    }\n\n    message += `\\nüìù **Prochaines √©tapes :**\\n`;\n    message += `1. Consulter le code g√©n√©r√© dans l'√©diteur\\n`;\n    message += `2. Tester l'application dans la preview\\n`;\n    message += `3. Demander des modifications si n√©cessaire\\n`;\n    message += `4. Exporter ou d√©ployer le projet\\n`;\n\n    return message;\n  }\n\n  /**\n   * G√©n√®re une r√©ponse √† une simple question\n   */\n  private generateQuestionResponse(question: string): string {\n    const lowerQuestion = question.toLowerCase();\n\n    if (lowerQuestion.includes('comment') || lowerQuestion.includes('aide')) {\n      return `üí° **Aide - Comment utiliser CodeCraft Studio ?**\n\nJe suis votre assistant d√©veloppeur IA. Voici ce que je peux faire :\n\n**Cr√©er des applications :**\n- \"Cr√©e une landing page moderne pour une startup SaaS\"\n- \"Je veux un e-commerce avec paiement Stripe\"\n- \"G√©n√®re un dashboard admin avec authentification\"\n\n**Fonctionnalit√©s :**\n- Upload de fichiers Word/Excel/PowerPoint pour g√©n√©rer des apps bas√©es sur vos documents\n- G√©n√©ration intelligente avec multi-agents (Design, Code, Test, Doc, etc.)\n- Preview live instantan√©e\n- Export en ZIP ou d√©ploiement direct\n\n**Exemples de commandes :**\n- \"Cr√©e une application [type] avec [features]\"\n- \"Ajoute l'authentification Google\"\n- \"Modifie le design en version minimale\"\n- \"G√©n√®re 3 variations de cette page\"\n\nQue voulez-vous cr√©er aujourd'hui ? üöÄ`;\n    }\n\n    return `Je suis pr√™t √† cr√©er votre application ! D√©crivez-moi ce que vous voulez, ou demandez de l'aide en tapant \"aide\" ou \"comment √ßa marche\".`;\n  }\n\n  /**\n   * R√©initialise l'√©tat de la conversation\n   */\n  resetState(): void {\n    this.conversationState = {\n      awaitingClarification: false,\n    };\n  }\n}\n"],"names":["IntentAnalyzer","userPrompt","uploadedFiles","normalizedPrompt","intent","requirements","clarification","prompt","createKeywords","modifyKeywords","questionKeywords","type","confidence","kw","features","featureMap","feature","keywords","stack","_a","_b","questions","s","ClarificationEngine","_c","_d","_e","suggestedDefaults","userResponse","previousRequirements","normalized","updatedRequirements","AgentOrchestrator","__publicField","selectedAgents","a","b","executionMode","estimatedTime","plan","apiUrl","results","promises","agent","result","index","startTime","response","data","executionTime","error","file","successfulResults","r","mergedCode","id","AppError","code","message","statusCode","details","ValidationError","formatErrorMessage","logError","context","timestamp","prefix","validateHTML","errors","warnings","openingTags","closingTags","openingTagNames","tag","closingTagNames","selfClosing","unclosedTags","t","inlineStylesCount","sanitizeHTML","sanitized","event","regex","validateProject","html","css","js","htmlResult","cssResult","jsResult","e","w","generateValidationReport","report","i","warning","AIDeveloper","planMessage","agentResults","generatedCode","validationResult","validationReport","responseMessage","appType","successCount","totalCount","totalTime","sum","question","lowerQuestion"],"mappings":"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"}